var app=angular.module("resourcesApp",["ngRoute","ui.calendar"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"templates/home.html"}),a.when("/login",{templateUrl:"templates/login.html"}),a.when("/bookings",{templateUrl:"templates/resources_view.html"}),a.when("/resources",{templateUrl:"templates/resources.html"}),a.when("/projects",{templateUrl:"templates/projects.html"}),a.otherwise({redirectTo:"/"}),window.history&&window.history.pushState}]),app.service("filterService",["$filter","$rootScope",function(a,b){return{filterObjArray:function(b,c,d){d(a("filter")(b,c))}}}]),app.service("getInfoService",["$rootScope","$http",function(a,b){return{getBookings:function(b,c,d){a.makeRequest("GET","api/public/booking",null,function(a){d?c(b,a.data,d):c(b,a.data)})},getBookingsDateRange:function(b,c){a.makeRequest("GET","api/public/booking/daterange/?"+b,null,function(a){c(a.data)})},getProjects:function(b){a.makeRequest("GET","api/public/project",null,function(a){b(a)})},getResources:function(b){a.makeRequest("GET","api/public/resource",null,function(a){b(a)})}}}]),app.controller("loginController",["$scope","$http",function(a,b){}]),app.controller("mainController",["$scope","$http","$rootScope",function(a,b,c){c.makeRequest=function(a,c,d,e){d||(d=null),b({url:c,method:a,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0,"Process-Data":!1}}).then(function(a){e(a)},function(a){console.log(a)})},c.closeMessage=function(){$(".custom_alert").remove()}}]),app.service("messageService",["$timeout","$rootScope",function(a,b){return{showMessage:function(b,c){return a(function(){c()},1500),$("body").append('<div class="alert alert-success custom_alert"><p>'+b+"</p></div>")},showConfirm:function(a,b){return $("body").append('<div class="alert alert-success custom_confirm"><p>'+a+'</p><button class="btn btn-primary" ng-click="callBack()">close</button></div>')}}}]),app.controller("navController",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),app.controller("resourceViewController",["$scope","$http","$rootScope","getInfoService","filterService","messageService","$timeout",function(a,b,c,d,e,f,g){function h(b,c,d){b.splice(0,b.length),angular.forEach(c,function(c,d){for(var e={title:c.title,start:c.start_date,end:c.end_date,id:c.id,notes:c.notes,resource_name:c.resource_name,project_name:c.project_name,createdBy:c.created_by,textColor:"white"},f=0;f<a.projects.length;f++)a.projects[f].name===c.project_name&&(e.color=a.projects[f].colour_code);b.push(e)}),d&&d(b)}function i(b){for(var c=0;c<a.eventSources[0].events.length;c++)if(parseInt(b)===parseInt(a.eventSources[0].events[c].id))return a.eventSources[0].events[c]}a.creatingBooking=!1,a.filterObj={},a.eventSources=[{events:[]}],d.getProjects(function(b){a.projects=b.data,d.getResources(function(b){a.resources=b.data})}),a.uiConfig={calendar:{height:700,editable:!0,selectable:!0,selectHelper:!0,allDayDefault:!0,header:{left:"month agendaWeek listMonth",center:"title",right:"today prev,next"},viewRender:function(b,c){a.bookingsForThisMonthQuery="start_date="+b.start.format()+"&end_date="+b.end.format(),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(b){h(a.eventSources[0].events,b)})})},eventClick:function(b){a.bookingToDisplay=i(b.id),a.showBookingData=!0},eventDrop:function(a,b,d){confirm("The start date for "+a.title+" will be changed to: "+a.start.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?start_date="+a.start.format()+"&end_date="+a.end.format(),null,function(a){f.showMessage(a.data,c.closeMessage)}):d()},select:function(b,c,d){a.creatingBooking=!0,a.bookingDates={startDate:b.format(),endDate:c.format()}},eventResize:function(a,b,d){confirm("The end date for "+a.title+" will be changed to: "+a.end.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?end_date="+a.end.format(),null,function(a){f.showMessage(a.data,c.closeMessage)}):d()}}},a.closeForm=function(){$("#bookingTitle")[0].value="",$("#bookingNotes")[0].value="",$("#resourceName")[0].value="",$("#projectName")[0].value="",a.creatingBooking=!1,a.showBookingData=!1},a.addBookingToDb=function(b){var e=new FormData;e.append("start_date",b.startDate),e.append("end_date",b.endDate),e.append("title",$("#bookingTitle")[0].value),e.append("notes",$("#bookingNotes")[0].value),e.append("resource_name",$("#resourceName")[0].value),e.append("project_name",$("#projectName")[0].value),c.makeRequest("POST","api/public/booking",e,function(b){f.showMessage(b.data,c.closeMessage),d.getBookings(a.eventSources[0].events,h)}),a.closeForm()},a.deleteBooking=function(b){confirm("Are you sure you want to DELETE "+i(b).title+"?")?c.makeRequest("DELETE","api/public/booking/"+b,null,function(b){f.showMessage(b.data,c.closeMessage),d.getBookings(a.eventSources[0].events,h),a.closeForm()}):a.closeForm()},a.updateBooking=function(b){if(confirm("Are you sure you want to UPDATE "+i(b).title+"?")){var e=new FormData;e.append("title",$("#editBookingTitle")[0].value),e.append("notes",$("#editBookingNotes")[0].value),e.append("resource_name",$("#editResourceName")[0].value),e.append("project_name",$("#editProjectName")[0].value),c.makeRequest("POST","api/public/booking/update/"+b,e,function(b){f.showMessage(b.data,c.closeMessage),d.getBookings(a.eventSources[0].events,h),a.closeForm()})}else a.closeForm()},a.filterMethod=function(b,c){a.filterObj[c]=b,d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(b){h(a.eventSources[0].events,b)})})}}]);