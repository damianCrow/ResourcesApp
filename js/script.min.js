var app=angular.module("resourcesApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/login",{templateUrl:"templates/login.html"}),a.when("/bookings",{templateUrl:"templates/resources_view.html",resolve:{auth:["authService",function(a){return a.userLoggedIn()}]}}),a.when("/resources",{templateUrl:"templates/resources.html",resolve:{auth:["authService",function(a){return a.isAdminUser()}]}}),a.when("/signup",{templateUrl:"templates/signup.html",resolve:{auth:["authService",function(a){return a.isAdminUser()}]}}),a.otherwise({redirectTo:"/login"}),window.history&&window.history.pushState}]),app.run(["$rootScope","authService","messageService",function(a,b,c){a.$on("$routeChangeError",function(b,d,e,f){"userNotLoggedIn"===f&&a.redirect("/login"),"userNotAdmin"===f&&(c.showMessage("Only ADMIN users can access this section",a.closeMessage),e.$$route.originalPath&&a.redirect(e.$$route.originalPath))})}]),app.service("authService",["$rootScope","$window","$location","messageService","$q",function(a,b,c,d,e){return{login:function(){var c=new FormData;c.append("email",$("#logInEmail")[0].value),c.append("password",$("#logInPassword")[0].value),a.makeRequest("POST","api/public/resource",c,function(c){"user not found!"===c.data?d.showMessage("Incorrect Email address or Password! Please try again.",function(){return a.closeMessage(),e.reject("userNotLoggedIn")}):(b.sessionStorage.setItem("user",angular.toJson(c.data)),a.redirect("/bookings"))})},logOut:function(){b.sessionStorage.removeItem("user"),a.redirect("/login")},userLoggedIn:function(){return null!==b.sessionStorage.getItem("user")?e.resolve(!0):e.reject("userNotLoggedIn")},isAdminUser:function(){return b.sessionStorage.getItem("user")?"1"===angular.fromJson(b.sessionStorage.getItem("user")).admin?(a.notAdminUser=!1,e.resolve(!0)):(a.notAdminUser=!0,e.reject("userNotAdmin")):(a.notAdminUser=!1,e.reject("userNotAdmin"))},getLoggedInUser:function(){return angular.fromJson(b.sessionStorage.getItem("user"))}}}]),app.service("filterService",["$filter","$rootScope",function(a,b){return{filterObjArray:function(b,c,d){d(a("filter")(b,c))}}}]),app.service("getInfoService",["$rootScope","$http",function(a,b){return{getBookings:function(b,c,d){a.makeRequest("GET","api/public/booking",null,function(a){d?c(b,a.data,d):c(b,a.data)})},getBookingsDateRange:function(b,c){a.makeRequest("GET","api/public/booking/daterange/?"+b,null,function(a){c(a.data)})},getProjects:function(b,c){a.makeRequest("GET","api/public/project",null,function(a){c?b(a,c):b(a)})},getResources:function(b){a.makeRequest("GET","api/public/resource",null,function(a){b(a)})}}}]),app.controller("loginController",["$scope","authService",function(a,b){a.login=b.login}]),app.controller("mainController",["$scope","$http","$rootScope","$location",function(a,b,c,d){c.makeRequest=function(a,c,d,e,f){d||(d=null),b({url:c,method:a,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0,"Process-Data":!1}}).then(function(a){e(a)},function(a){f&&f(a)})},c.closeMessage=function(){$(".custom_alert").remove()},c.redirect=function(a){return d.path(a)},c.resourceTypes=["Developer","Designer","Project Manager","Copy Writer"]}]),app.service("messageService",["$timeout","$rootScope",function(a,b){return{showMessage:function(b,c,d){return a(function(){d()},2e3),$("body").append('<div class="alert '+b+' custom_alert"><h6>'+c+"</h6></div>")},showConfirm:function(a,b,c){var d=document.createElement("button");d.innerHTML="Confirm",d.className="btn btn-warning float-md-right confirm_button";var e=document.createElement("button");e.innerHTML="Cancel",e.className="btn btn-info float-md-right";var f=document.createElement("div");f.className="alert alert-warning custom_confirm";var g=document.createElement("h6");return g.innerHTML=a,f.append(g),f.append(e),f.append(d),d.onclick=function(){return $(".alert.alert-warning.custom_confirm").remove(),b()},e.onclick=function(){if($(".alert.alert-warning.custom_confirm").remove(),c)return c()},$("body").append(f)}}}]),app.controller("navController",["$scope","$location","authService",function(a,b,c){a.logOut=c.logOut,a.isActive=function(a){return a===b.path()}}]),app.controller("resourceController",["$scope","getInfoService",function(a,b){b.getResources(function(b){a.resources=b.data})}]),app.controller("resourceViewController",["$scope","$http","$rootScope","getInfoService","filterService","messageService","$timeout","authService",function(a,b,c,d,e,f,g,h){function i(b,c,d){b.splice(0,b.length),angular.forEach(c,function(c,d){for(var e={id:c.id,title:c.title,name:'<span class="booking_details">'+c.title+'</span><span class="booking_details">'+c.resource_name+"</span>",start:moment(c.start_date),end:moment(c.end_date),notes:c.notes,resource_name:c.resource_name,project_name:c.project_name,createdBy:c.created_by,classes:"item-status-three"},f=0;f<a.projects.length;f++)a.projects[f].name===c.project_name&&(e.projectColor=a.projects[f].colour_code,e.sectionID=a.projects[f].id);b.push(e)}),d&&d(b)}function j(b,c){a.projects=b.data,m.Sections.splice(0,m.Sections.length),angular.forEach(b.data,function(a){var b={id:a.id,name:a.name,color:a.colour_code,notes:a.notes};m.Sections.push(b)}),d.getResources(function(b){a.resources=b.data,c&&c()})}function k(b){"newBookingForm"===b&&($("#bookingTitle")[0].value="",$("#bookingNotes")[0].value="",$("#resourceName")[0].value="",$("#projectName")[0].value="",a.creatingBooking=!1),"displayBookingForm"===b&&(a.showBookingData=!1),"newProjectForm"===b&&($("#newProjectName")[0].value="",$("#projectColorCode")[0].value="#000000",a.creatingProject=!1),"editProjectForm"===b&&(a.showProjectData=!1)}h.isAdminUser();var l=moment().startOf("day");a.startDay=moment(l),a.creatingBooking=!1,a.creatingProject=!1,a.showBookingData=!1,a.filterObj={},a.selectedPeriod="1 week";var m={Periods:[{Name:"1 day",Label:"1 day",TimeframePeriod:60,TimeframeOverall:1440,TimeframeHeaders:["Do MMM","HH"],Classes:"period-1day"},{Name:"3 days",Label:"3 days",TimeframePeriod:180,TimeframeOverall:4320,TimeframeHeaders:["Do MMM","HH"],Classes:"period-3day"},{Name:"1 week",Label:"1 week",TimeframePeriod:1440,TimeframeOverall:10080,TimeframeHeaders:["MMM","Do"],Classes:"period-1week"},{Name:"1 month",Label:"1 month",TimeframePeriod:1440,TimeframeOverall:40320,TimeframeHeaders:["MMM","Do"],Classes:"period-1month"}],Items:[],Sections:[],Init:function(){TimeScheduler.Scope=a,TimeScheduler.Options.GetSections=m.GetSections,TimeScheduler.Options.GetSchedule=m.GetSchedule,TimeScheduler.Options.Start=a.startDay,TimeScheduler.Options.Periods=m.Periods,TimeScheduler.Options.SelectedPeriod=a.selectedPeriod,TimeScheduler.Options.Element=$(".calendar"),TimeScheduler.Options.AllowDragging=!0,TimeScheduler.Options.AllowResizing=!0,TimeScheduler.Options.Events.ItemClicked=m.Item_Clicked,TimeScheduler.Options.Events.ItemDropped=m.Item_Dragged,TimeScheduler.Options.Events.ItemResized=m.Item_Resized,TimeScheduler.Options.Events.ItemMovement=m.Item_Movement,TimeScheduler.Options.Events.ItemMovementStart=m.Item_MovementStart,TimeScheduler.Options.Events.ItemMovementEnd=m.Item_MovementEnd,TimeScheduler.Options.Text.NextButton="&nbsp;",TimeScheduler.Options.Text.PrevButton="&nbsp;",TimeScheduler.Options.MaxHeight=100,c.notAdminUser?TimeScheduler.isAdminUser=!1:TimeScheduler.isAdminUser=!0,TimeScheduler.updateStart=function(b){a.$apply(function(){a.bookingsStartDate=b.format()}),a.startDay=b.format(),a.getBookings(i)},TimeScheduler.createAppendElement=function(a,b,c,d,e){var f=document.createElement(a);b.forEach(function(a){f.classList.add(a)}),f.innerHTML=c,f.addEventListener("click",function(){e()}),d.append(f)},void 0!==a.relevantProject&&(m.Sections.splice(0,m.Sections.length),m.Sections.push(a.relevantProject)),TimeScheduler.Init()},GetSections:function(a){a(m.Sections)},GetSchedule:function(a,b,c){a(m.Items)},Item_Clicked:function(b){a.bookingToDisplay=b,a.$apply(function(){a.showBookingData=!0})},Item_Dragged:function(b,g,h,j){if(c.notAdminUser)return f.showMessage("alert-danger","You must be an ADMIN user to change a booking!",c.closeMessage),m.Init();if(h.format()<moment().format())return f.showMessage("alert-danger","You cannot drag a booking into the past!",c.closeMessage),TimeScheduler.Init();for(var k,l=0;l<m.Items.length;l++)if(m.Items[l].id===b.id)return k=m.Items[l],f.showConfirm("The start date for "+b.title+" will be changed to: "+h.format("MMMM Do YYYY, h:mm a"),function(){k.start=h,k.end=j,k.sectionID=g;for(var b=0;b<m.Sections.length;b++)m.Sections[b].id===k.sectionID&&(k.project_name=m.Sections[b].name);c.makeRequest("PUT","api/public/booking/update/"+k.id+"?start_date="+moment.utc(moment(k.start)).format()+"&end_date="+moment.utc(moment(k.end)).format()+"&project_name="+k.project_name,null,function(b){f.showMessage("alert-info",b.data,c.closeMessage),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(a){i(m.Items,a,m.Init)})})})},TimeScheduler.Init);d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(a){i(m.Items,a,m.Init)})},Item_Resized:function(b,g,h){if(c.notAdminUser)return f.showMessage("alert-danger","You must be an ADMIN user to change a booking!",c.closeMessage),m.Init();if(g.format()<moment().format())return f.showMessage("alert-danger","You cannot extend a booking into the past!",c.closeMessage),TimeScheduler.Init();for(var j,k=0;k<m.Items.length;k++)if(j=m.Items[k],j.id===b.id){if(j.start=g,j.end=h,m.Items[k]=j,!confirm(b.title+" will start: "+g.format("MMMM Do YYYY, h:mm a")+" and end: "+h.format("MMMM Do YYYY, h:mm a")))return TimeScheduler.Init();c.makeRequest("PUT","api/public/booking/update/"+j.id+"?start_date="+moment.utc(moment(j.start)).format()+"&end_date="+moment.utc(moment(j.end)).format(),null,function(b){f.showMessage("alert-info",b.data,c.closeMessage),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(a){i(m.Items,a,m.Init)})})})}TimeScheduler.Init()},Item_Movement:function(a,b,c){var d;d="<div>",d+="   <div>",d+="       Start: "+b.format("Do MMM YYYY HH:mm"),d+="   </div>",d+="   <div>",d+="       End: "+c.format("Do MMM YYYY HH:mm"),d+="   </div>",d+="</div>",$(".realtime-info").empty().append(d)},Item_MovementStart:function(){$(".realtime-info").show()},Item_MovementEnd:function(){$(".realtime-info").hide()}};if(d.getProjects(j),a.closeForm=k,a.addBookingToDb=function(b){if(a.bookingsStartDate<=moment(l).add(-1,"days").format())return a.closeForm("newBookingForm"),f.showMessage("alert-danger","You cannot create a booking in the past!",c.closeMessage);var g=new FormData;g.append("start_date",a.bookingsStartDate),g.append("end_date",moment.utc(moment(a.bookingsStartDate).add(1,"days")).format()),g.append("title",$("#bookingTitle")[0].value),g.append("notes",$("#bookingNotes")[0].value),g.append("resource_name",$("#resourceName")[0].value),g.append("project_name",$("#projectName")[0].value),c.makeRequest("POST","api/public/booking",g,function(b){f.showMessage("alert-info",b.data,c.closeMessage),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(a){i(m.Items,a,m.Init)})})}),a.closeForm("newBookingForm")},a.deleteBooking=function(b){c.notAdminUser?f.showMessage("alert-danger","You must be an ADMIN user to delete a booking!",c.closeMessage):(f.showConfirm("Are you sure you want to DELETE "+a.bookingToDisplay.title+"?",function(){c.makeRequest("DELETE","api/public/booking/"+b,null,function(b){f.showMessage("alert-info",b.data,c.closeMessage),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(a){i(m.Items,a,m.Init)})})})}),a.closeForm("displayBookingForm"))},a.updateBooking=function(b){c.notAdminUser?f.showMessage("alert-danger","You must be an ADMIN user to update a booking!",c.closeMessage):(f.showConfirm("Are you sure you want to UPDATE "+a.bookingToDisplay.title+"?",function(){var g=new FormData;g.append("title",$("#editBookingTitle")[0].value),g.append("notes",$("#editBookingNotes")[0].value),g.append("resource_name",$("#editResourceName")[0].value),g.append("project_name",$("#editProjectName")[0].value),c.makeRequest("POST","api/public/booking/update/"+b,g,function(b){f.showMessage("alert-info",b.data,c.closeMessage),d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(b){e.filterObjArray(b,a.filterObj,function(a){i(m.Items,a,m.Init)})})})}),a.closeForm("displayBookingForm"))},a.saveProject=function(){var b=new FormData;b.append("name",$("#newProjectName")[0].value),b.append("color",$("#projectColorCode")[0].value),b.append("notes",$("#projectNotes")[0].value),c.makeRequest("POST","api/public/project",b,function(a){f.showMessage("alert-info",a.data,c.closeMessage),d.getProjects(j,TimeScheduler.Init)}),a.closeForm("newProjectForm")},a.updateProject=function(b){c.notAdminUser?f.showMessage("alert-danger","You must be an ADMIN user to update a project!",c.closeMessage):(f.showConfirm("Are you sure you want to UPDATE "+a.projectDataToDisplay.name+"?",function(){var a=new FormData;a.append("name",$("#projectEditName")[0].value),a.append("color",$("#projectEditColorCode")[0].value),a.append("notes",$("#projectEditNotes")[0].value),c.makeRequest("POST","api/public/project/update/"+b,a,function(a){f.showMessage("alert-info",a.data,c.closeMessage),d.getProjects(j,TimeScheduler.Init)})}),a.closeForm("editProjectForm"))},a.deleteProject=function(b){c.notAdminUser?f.showMessage("alert-danger","You must be an ADMIN user to delete a project!",c.closeMessage):(f.showConfirm("Are you sure you want to DELETE "+a.projectDataToDisplay.name+"?",function(){c.makeRequest("DELETE","api/public/project/"+b,null,function(a){f.showMessage("alert-info",a.data,c.closeMessage),d.getProjects(j,TimeScheduler.Init)})}),a.closeForm("editProjectForm"))},a.filterMethod=function(b,c){a.filterObj[c]=b,d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(f){e.filterObjArray(f,a.filterObj,function(e){i(m.Items,e,function(){d.getProjects(j),0===b.length&&"project_name"===c&&(a.relevantProject=void 0),"project_name"===c&&""!==b&&angular.forEach(m.Sections,function(c){c.name===b&&(a.relevantProject=c)}),m.Init()})})})},c.notAdminUser){a.notAdmin=!0;var n=h.getLoggedInUser().first_name+" "+h.getLoggedInUser().last_name;a.filterMethod(n,"resource_name")}a.getBookings=function(b){a.bookingsEndDate=moment(a.bookingsStartDate).add(37,"days").format(),a.bookingsForThisMonthQuery="start_date="+a.bookingsStartDate+"&end_date="+a.bookingsEndDate,d.getBookingsDateRange(a.bookingsForThisMonthQuery,function(c){e.filterObjArray(c,a.filterObj,function(a){b(m.Items,a,m.Init)})})},angular.element(document).ready(function(){a.bookingsStartDate=moment.utc(moment(l)).format(),a.getBookings(i)})}]),app.controller("signUpController",["$scope","$rootScope","messageService",function(a,b,c){a.signUp=function(){if($("#signUpAdmin")[0].checked)var a=1;else a=0;if($("#signUpBookable")[0].checked)var d=1;else d=0;var e=new FormData;e.append("first_name",$("#signUpFirstName")[0].value),e.append("last_name",$("#signUpLastName")[0].value),e.append("email",$("#signUpEmail")[0].value),e.append("resource_type",$("#signUpResourceType")[0].value),e.append("password",$("#signUpPassword")[0].value),e.append("admin",a),e.append("bookable",d),b.makeRequest("POST","api/public/resource/signup",e,function(a){c.showMessage(a.data,b.closeMessage),b.redirect("/")})}}]);var TimeScheduler={Options:{GetSections:function(a){},GetSchedule:function(a,b,c){},Start:moment(),HeaderFormat:"Do MMM YYYY",LowerFormat:"DD-MMM-YYYY HH:mm",Periods:[{Name:"2 days",Label:"2 days",TimeframePeriod:120,TimeframeOverall:2880,TimeframeHeaders:["Do MMM","HH"],Classes:"time-sch-period-2day"},{Name:"2 weeks",Label:"2 weeks",TimeframePeriod:1440,TimeframeOverall:20160,TimeframeHeaders:["MMM","Do"],Classes:"time-sch-period-2week"}],SelectedPeriod:"2 weeks",Element:$("<div></div>"),MinRowHeight:40,ShowCurrentTime:!0,ShowGoto:!0,ShowToday:!0,Text:{NextButton:"Next",NextButtonTitle:"Next period",PrevButton:"Prev",PrevButtonTitle:"Previous period",TodayButton:"Today",TodayButtonTitle:"Go to today",GotoButton:"Go to",GotoButtonTitle:"Go to specific date"},Events:{ItemMouseEnter:null,ItemMouseLeave:null,ItemClicked:null,ItemDropped:null,ItemResized:null,ItemMovement:null,ItemMovementStart:null,ItemMovementEnd:null,ItemEventClick:null,ItemEventMouseEnter:null,ItemEventMouseLeave:null},AllowDragging:!1,AllowResizing:!1,DisableOnMove:!0,MaxHeight:null},Wrapper:null,HeaderWrap:null,TableWrap:null,ContentHeaderWrap:null,ContentWrap:null,TableHeader:null,TableContent:null,SectionWrap:null,Table:null,Sections:{},CachedSectionResult:null,CachedScheduleResult:null,SetupPrototypes:function(){moment.fn.tsAdd=function(a,b){var c;return c="string"==typeof a?moment.duration(+b,a):moment.duration(a,b),this.tsAddOrSubtractDurationFromMoment(this,c,1),this},moment.fn.tsSubtract=function(a,b){var c;return c="string"==typeof a?moment.duration(+b,a):moment.duration(a,b),this.tsAddOrSubtractDurationFromMoment(this,c,-1),this},moment.fn.tsAddOrSubtractDurationFromMoment=function(a,b,c){var d,e=b._milliseconds,f=b._days,g=b._months;e&&a.milliseconds(a.milliseconds()+e*c),f&&a.date(a.date()+f*c),g&&(d=a.date(),a.date(1).month(a.month()+g*c).date(Math.min(d,a.daysInMonth())))}},Init:function(a){TimeScheduler.SetupPrototypes(),TimeScheduler.Options.Start=moment(TimeScheduler.Options.Start),TimeScheduler.Options.Element.find(".ui-draggable").draggable("destroy"),TimeScheduler.Options.Element.empty(),TimeScheduler.Wrapper=$(document.createElement("div")).addClass("time-sch-wrapper").appendTo(TimeScheduler.Options.Element),TimeScheduler.HeaderWrap=$(document.createElement("div")).addClass("time-sch-header-wrapper time-sch-clearfix").appendTo(TimeScheduler.Wrapper),TimeScheduler.TableWrap=$(document.createElement("div")).addClass("time-sch-table-wrapper").appendTo(TimeScheduler.Wrapper),TimeScheduler.CreateCalendar(),TimeScheduler.FillSections(a),TimeScheduler.isAdminUser&&(TimeScheduler.createAppendElement("button",["btn","btn-primary"],"New Booking",$(".time-sch-section.time-sch-section-header")[0],function(){TimeScheduler.Scope.$apply(function(){TimeScheduler.Scope.showBookingData=!1,TimeScheduler.Scope.creatingProject=!1,TimeScheduler.Scope.creatingBooking=!0})}),TimeScheduler.createAppendElement("button",["btn","btn-info"],"New Project",$(".time-sch-section.time-sch-section-header")[1],function(){TimeScheduler.Scope.$apply(function(){TimeScheduler.Scope.showBookingData=!1,TimeScheduler.Scope.creatingBooking=!1,TimeScheduler.Scope.creatingProject=!0})}))},GetSelectedPeriod:function(){for(var a,b=0;b<TimeScheduler.Options.Periods.length;b++)if(TimeScheduler.Options.Periods[b].Name===TimeScheduler.Options.SelectedPeriod){a=TimeScheduler.Options.Periods[b];break}return a||(a=TimeScheduler.Options.Periods[0],TimeScheduler.SelectPeriod(a.Name)),a},GetEndOfPeriod:function(a,b){return moment(a).tsAdd("minutes",b.TimeframeOverall)},AddHeaderClasses:function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(d=TimeScheduler.TableHeader.find("tr"),void 0!==c&&(d=$(d.get(c))),d.length&&d.length>0){e=$.makeArray(d);for(var n=0;n<e.length;n++){l=!1,j=0,f=$(e[n]),g=$.makeArray(f.find(".time-sch-date-header"));for(var o=0;o<g.length&&!l;o++)h=$(g[o]),k=Number(h.attr("colspan")),k&&!isNaN(k)&&k>0?(i=j||0,j=i+k):(i=j||0,j=i+1),i===b&&a.addClass("time-sch-header-"+n+"-date-start"),j-1===b&&a.addClass("time-sch-header-"+n+"-date-end"),i<=b&&b<j&&(l=!0,m=o%2==0,a.addClass("time-sch-header-"+n+"-date-column-"+o).addClass("time-sch-header-"+n+"-date-"+(m?"even":"odd")),h.hasClass("time-sch-header-"+n+"-current-time")&&a.addClass("time-sch-header-"+n+"-current-time"))}}},CreateCalendar:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;l=0,f=TimeScheduler.GetSelectedPeriod(),g=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,f),d=Math.abs(TimeScheduler.Options.Start.diff(g,"minutes")),e=d/f.TimeframePeriod,TimeScheduler.ContentHeaderWrap=$(document.createElement("div")).addClass("time-sch-content-header-wrap").appendTo(TimeScheduler.TableWrap),TimeScheduler.ContentWrap=$(document.createElement("div")).addClass("time-sch-content-wrap").appendTo(TimeScheduler.TableWrap),TimeScheduler.TableHeader=$(document.createElement("table")).addClass("time-sch-table time-sch-table-header").appendTo(TimeScheduler.ContentHeaderWrap),TimeScheduler.TableContent=$(document.createElement("table")).addClass("time-sch-table time-sch-table-content").appendTo(TimeScheduler.ContentWrap),TimeScheduler.SectionWrap=$(document.createElement("div")).addClass("time-sch-section-wrapper").appendTo(TimeScheduler.ContentWrap),f.Classes&&TimeScheduler.TableWrap.toggleClass(f.Classes,!0);for(var n=0;n<f.TimeframeHeaders.length;n++){i=null,k=null,isEven=!0,l=0,m=0,c=f.TimeframeHeaders[n],a=$(document.createElement("tr")).addClass("time-sch-times time-sch-times-header-"+n).appendTo(TimeScheduler.TableHeader),b=$(document.createElement("td")).addClass("time-sch-section time-sch-section-header").appendTo(a);for(var o=0;o<e;o++){if(h=moment(TimeScheduler.Options.Start).tsAdd("minutes",o*f.TimeframePeriod),j=h.format(c),k!==j){i&&(b.attr("colspan",l),l=0,moment()>=i&&moment()<h&&b.addClass("time-sch-header-"+n+"-current-time")),i=h,k=j,b=$(document.createElement("td")).data("header-row",n).data("column-count",o).data("column-is-even",isEven).addClass("time-sch-date time-sch-date-header").append(j).appendTo(a),b.addClass("time-sch-header-"+n+"-date-start").addClass("time-sch-header-"+n+"-date-end").addClass("time-sch-header-"+n+"-date-column-"+m).addClass("time-sch-header-"+n+"-date-"+(m%2==0?"even":"odd"));for(var p=0;p<n;p++)TimeScheduler.AddHeaderClasses(b,o,p);m+=1}l+=1}b.attr("colspan",l)}TimeScheduler.FillHeader()},CreateSections:function(a){var b,c,d,e,f,g;for(b=1,f=$.makeArray(TimeScheduler.TableHeader.find("tr")),g=0;g<f.length;g++)b<$(f[g]).find(".time-sch-date-header").length&&(b=$(f[g]).find(".time-sch-date-header").length);for(g=0;g<a.length;g++){for(c=$(document.createElement("tr")).addClass("time-sch-section-row").addClass(g%2==0?"time-sch-section-even":"time-sch-section-odd").css("height",TimeScheduler.Options.MinRowHeight).appendTo(TimeScheduler.TableContent),e=$(document.createElement("div")).addClass("time-sch-section-container").css("height",TimeScheduler.Options.MinRowHeight).data("section",a[g]).appendTo(TimeScheduler.SectionWrap),d=$(document.createElement("td")).addClass("time-sch-section time-sch-section-content").data("section",a[g]).append(a[g].name).css({color:a[g].color}).appendTo(c),TimeScheduler.elementClick(d,a[g],function(a,b){TimeScheduler.Scope.$apply(function(){TimeScheduler.Scope.projectDataToDisplay=b,TimeScheduler.Scope.showBookingData=!1,TimeScheduler.Scope.creatingProject=!1,TimeScheduler.Scope.creatingBooking=!1,TimeScheduler.Scope.showProjectData=!0})}),time=0;time<b;time++)d=$(document.createElement("td")).addClass("time-sch-date time-sch-date-content").appendTo(c),TimeScheduler.AddHeaderClasses(d,time);TimeScheduler.Sections[a[g].id]={row:c,container:e}}TimeScheduler.SectionWrap.css({left:TimeScheduler.Options.Element.find(".time-sch-section").outerWidth()}),TimeScheduler.Options.ShowCurrentTime&&TimeScheduler.ShowCurrentTime()},elementClick:function(a,b,c){a.click(function(a){c(a,b)})},ShowCurrentTimeHandle:null,ShowCurrentTime:function(){var a,b,c,d,e;TimeScheduler.ShowCurrentTimeHandle&&clearTimeout(TimeScheduler.ShowCurrentTimeHandle),a=moment(),e=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,TimeScheduler.GetSelectedPeriod()),c=Math.abs(TimeScheduler.Options.Start.diff(e,"minutes")),d=Math.abs(TimeScheduler.Options.Start.diff(a,"minutes")),b=TimeScheduler.Options.Element.find(".time-sch-current-time"),b.remove(),a>=TimeScheduler.Options.Start&&a<=e&&(b=$(document.createElement("div")).addClass("time-sch-current-time").css("left",d/c*100+"%").attr("title",a.format(TimeScheduler.Options.LowerFormat)).appendTo(TimeScheduler.SectionWrap)),TimeScheduler.ShowCurrentTimeHandle=setTimeout(TimeScheduler.ShowCurrentTime,3e4)},CreateItems:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w={};for(t=TimeScheduler.GetSelectedPeriod(),u=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,t),g=Math.abs(TimeScheduler.Options.Start.diff(u,"minutes")),v=0;v<a.length;v++)if(b=a[v],(d=TimeScheduler.Sections[b.sectionID])&&(w[b.sectionID]||(w[b.sectionID]=[]),b.start<=u&&b.end>=TimeScheduler.Options.Start)){if(p=null,n=moment(Math.max(b.start,TimeScheduler.Options.Start)),o=moment(Math.min(b.end,u)),h=n.diff(TimeScheduler.Options.Start,"minutes"),i=Math.abs(n.diff(o,"minutes")),k=0,l=h/g*100,m=i/g*100,e=$(document.createElement("div")).addClass("time-sch-item "+(b.classes?b.classes:"")).css({top:k,background:"-webkit-linear-gradient(top, #C1C1C1 -90%, "+b.projectColor+" 100%)",borderRadius:"5px",borderColor:b.projectColor,left:l+"%",width:m+"%"}).appendTo(d.container),f=$(document.createElement("div")).addClass("time-sch-item-content").appendTo(e),b.name&&$(document.createElement("div")).append(b.name).appendTo(f),b.events)for(var x=0;x<b.events.length;x++)c=b.events[x],j=c.at.diff(n,"minutes")/i*100,$(document.createElement("div")).addClass("time-sch-item-event "+(c.classes?c.classes:"")).css("left",j+"%").attr("title",c.at.format(TimeScheduler.Options.LowerFormat)+" - "+c.label).data("event",c).appendTo(e);b.start>=TimeScheduler.Options.Start&&$(document.createElement("div")).addClass("time-sch-item-start").appendTo(e),b.end<=u&&$(document.createElement("div")).addClass("time-sch-item-end").appendTo(e),b.Element=e;for(var y=0;y<w[b.sectionID].length;y++)if(w[b.sectionID][y].start>b.start){p=y;break}null===p&&(p=w[b.sectionID].length),w[b.sectionID].splice(p,0,b),e.data("item",b),TimeScheduler.SetupItemEvents(e)}for(var z in w)for(d=TimeScheduler.Sections[z],v=0;v<w[z].length;v++){var A,B;q=w[z][v];for(var C=0;C<v;C++){var D,E;r=w[z][C],D=r.Element.position().top,E=D+r.Element.outerHeight(),A=q.Element.position().top,B=A+q.Element.outerHeight(),s=(r.start<=q.start&&q.start<=r.end||r.start<=q.end&&q.end<=r.end)&&(D<=A&&A<=E||D<=B&&B<=E),s&&q.Element.css("top",E+1)}B=q.Element.position().top+q.Element.outerHeight()+1,B>d.container.height()&&(d.container.css("height",B),d.row.css("height",B))}},SetupItemEvents:function(a){if(TimeScheduler.Options.Events.ItemClicked&&a.click(function(a){a.preventDefault(),TimeScheduler.Options.Events.ItemClicked.call(this,$(this).data("item"))}),TimeScheduler.Options.Events.ItemMouseEnter&&a.mouseenter(function(a){TimeScheduler.Options.Events.ItemMouseEnter.call(this,$(this).data("item"))}),TimeScheduler.Options.Events.ItemMouseLeave&&a.mouseleave(function(a){TimeScheduler.Options.Events.ItemMouseLeave.call(this,$(this).data("item"))}),TimeScheduler.Options.AllowDragging&&(a.draggable({helper:"clone",zIndex:1,appendTo:TimeScheduler.SectionWrap,distance:5,snap:".time-sch-section-container",snapMode:"inner",snapTolerance:10,drag:function(a,b){var c,d,e,f,g,h;TimeScheduler.Options.Events.ItemMovement&&(f=TimeScheduler.GetSelectedPeriod(),g=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,f),h=Math.abs(TimeScheduler.Options.Start.diff(g,"minutes")),c=$(a.target).data("item"),d=moment(TimeScheduler.Options.Start).tsAdd("minutes",h*(b.helper.position().left/TimeScheduler.SectionWrap.width())),e=moment(d).tsAdd("minutes",Math.abs(c.start.diff(c.end,"minutes"))),c.start<TimeScheduler.Options.Start&&(d.tsAdd("minutes",c.start.diff(TimeScheduler.Options.Start,"minutes")),e.tsAdd("minutes",c.start.diff(TimeScheduler.Options.Start,"minutes"))),TimeScheduler.Options.Events.ItemMovement.call(this,c,d,e))},start:function(a,b){$(this).hide(),b.helper.children().not(".time-sch-item-content").remove(),TimeScheduler.Options.Events.ItemMovementStart&&TimeScheduler.Options.Events.ItemMovementStart.call(this)},stop:function(a,b){$(this).length&&$(this).show(),TimeScheduler.Options.Events.ItemMovementEnd&&TimeScheduler.Options.Events.ItemMovementEnd.call(this)},cancel:".time-sch-item-end, .time-sch-item-start, .time-sch-item-event"}),$(".time-sch-section-container").droppable({greedy:!0,hoverClass:"time-sch-droppable-hover",tolerance:"pointer",drop:function(a,b){var c,d,e,f,g,h,i;g=TimeScheduler.GetSelectedPeriod(),h=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,g),i=Math.abs(TimeScheduler.Options.Start.diff(h,"minutes")),c=b.draggable.data("item"),d=$(this).data("section").id,e=moment(TimeScheduler.Options.Start).tsAdd("minutes",i*(b.helper.position().left/$(this).width())),f=moment(e).tsAdd("minutes",Math.abs(c.start.diff(c.end,"minutes"))),c.start<TimeScheduler.Options.Start&&(e.tsAdd("minutes",c.start.diff(TimeScheduler.Options.Start,"minutes")),f.tsAdd("minutes",c.start.diff(TimeScheduler.Options.Start,"minutes"))),b.draggable.appendTo($(this)),b.draggable.css({left:b.helper.position().left-$(this).position().left,top:b.helper.position().top-$(this).position().top}),TimeScheduler.Options.DisableOnMove&&(b.draggable.data("uiDraggable")&&b.draggable.draggable("disable"),b.draggable.data("uiResizable")&&b.draggable.resizable("disable")),b.draggable.show(),TimeScheduler.Options.Events.ItemDropped&&setTimeout(function(){TimeScheduler.Options.Events.ItemDropped.call(this,c,d,e,f)},0)}})),TimeScheduler.Options.AllowResizing){var b=null;a.find(".time-sch-item-start").length&&a.find(".time-sch-item-end").length?b="e, w":a.find(".time-sch-item-start").length?b="w":a.find(".time-sch-item-end").length&&(b="e"),b&&a.resizable({handles:b,resize:function(a,b){var c,d,e,f,g,h;TimeScheduler.Options.Events.ItemMovement&&(f=TimeScheduler.GetSelectedPeriod(),g=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,f),h=Math.abs(TimeScheduler.Options.Start.diff(g,"minutes")),c=$(this).data("item"),b.position.left!==b.originalPosition.left?(d=moment(TimeScheduler.Options.Start).tsAdd("minutes",h*($(this).position().left/TimeScheduler.SectionWrap.width())),e=c.end):(d=c.start,e=moment(TimeScheduler.Options.Start).tsAdd("minutes",h*(($(this).position().left+$(this).width())/TimeScheduler.SectionWrap.width()))),TimeScheduler.Options.Events.ItemMovement.call(this,c,d,e))},start:function(a,b){$(this).find(".time-sch-item-event").hide(),TimeScheduler.Options.Events.ItemMovementStart&&TimeScheduler.Options.Events.ItemMovementStart.call(this)},stop:function(a,b){var c,d,e,f,g,h,i;i=$(this),f=TimeScheduler.GetSelectedPeriod(),g=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,f),h=Math.abs(TimeScheduler.Options.Start.diff(g,"minutes")),c=i.data("item"),b.position.left!==b.originalPosition.left?(d=moment(TimeScheduler.Options.Start).tsAdd("minutes",h*(i.position().left/TimeScheduler.SectionWrap.width())),e=c.end):(d=c.start,e=moment(TimeScheduler.Options.Start).tsAdd("minutes",h*((i.position().left+i.width())/TimeScheduler.SectionWrap.width()))),TimeScheduler.Options.DisableOnMove&&(i.data("uiDraggable")&&i.draggable("disable"),i.data("uiResizable")&&i.resizable("disable"),i.find(".time-sch-item-event").show()),TimeScheduler.Options.Events.ItemMovementEnd&&TimeScheduler.Options.Events.ItemMovementEnd.call(this),TimeScheduler.Options.Events.ItemResized&&TimeScheduler.Options.Events.ItemResized.call(this,c,d,e)}})}TimeScheduler.Options.Events.ItemEventClicked&&a.find(".time-sch-item-event").click(function(a){var b=$(this).closest(".time-sch-item");a.preventDefault(),TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),b.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseEnter&&a.find(".time-sch-item-event").mouseenter(function(a){var b=$(this).closest(".time-sch-item");a.preventDefault(),TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),b.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseLeave&&a.find(".time-sch-item-event").mouseleave(function(a){var b=$(this).closest(".time-sch-item");a.preventDefault(),
TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),b.data("item"))})},FillSections:function(a){!TimeScheduler.CachedSectionResult||a?TimeScheduler.Options.GetSections.call(this,TimeScheduler.FillSections_Callback):TimeScheduler.FillSections_Callback(TimeScheduler.CachedSectionResult)},FillSections_Callback:function(a){TimeScheduler.CachedSectionResult=a,TimeScheduler.CreateSections(a),TimeScheduler.FillSchedule()},FillSchedule:function(){var a,b;a=TimeScheduler.GetSelectedPeriod(),b=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,a),TimeScheduler.Options.GetSchedule.call(this,TimeScheduler.FillSchedule_Callback,TimeScheduler.Options.Start,b)},FillSchedule_Callback:function(a){TimeScheduler.CachedScheduleResult=a,TimeScheduler.CreateItems(a)},FillHeader:function(){var a,b,c,d,e,f;b=$(document.createElement("div")).addClass("time-sch-period-container"),c=$(document.createElement("div")).addClass("time-sch-time-container"),a=$(document.createElement("div")).addClass("time-sch-title"),TimeScheduler.HeaderWrap.empty().append(b,c,a),d=TimeScheduler.GetSelectedPeriod(),e=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,d),a.text(TimeScheduler.Options.Start.format(TimeScheduler.Options.HeaderFormat)+" - "+e.tsAdd("minutes",-1).format(TimeScheduler.Options.HeaderFormat));for(var g=0;g<TimeScheduler.Options.Periods.length;g++)f=TimeScheduler.Options.Periods[g],$(document.createElement("a")).addClass("time-sch-period-button time-sch-button").addClass(f.Name===d.Name?"time-sch-selected-button":"").attr("href","#").append(f.Label).data("period",f).click(TimeScheduler.Period_Clicked).appendTo(b);TimeScheduler.Options.ShowGoto&&$(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-goto time-sch-button").attr({href:"#",title:TimeScheduler.Options.Text.GotoButtonTitle}).append(TimeScheduler.Options.Text.GotoButton).click(TimeScheduler.GotoTimeShift_Clicked).appendTo(c),TimeScheduler.Options.ShowToday&&$(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-today time-sch-button").attr({href:"#",title:TimeScheduler.Options.Text.TodayButtonTitle}).append(TimeScheduler.Options.Text.TodayButton).click(TimeScheduler.TimeShift_Clicked).appendTo(c),$(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-prev time-sch-button").attr({href:"#",title:TimeScheduler.Options.Text.PrevButtonTitle}).append(TimeScheduler.Options.Text.PrevButton).click(TimeScheduler.TimeShift_Clicked).appendTo(c),$(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-next time-sch-button").attr({href:"#",title:TimeScheduler.Options.Text.NextButtonTitle}).append(TimeScheduler.Options.Text.NextButton).click(TimeScheduler.TimeShift_Clicked).appendTo(c)},GotoTimeShift_Clicked:function(a){a.preventDefault(),$(document.createElement("input")).attr("type","text").css({position:"absolute",left:0,bottom:0}).appendTo($(this)).datepicker({onClose:function(){$(this).remove()},onSelect:function(a){TimeScheduler.Options.Start=moment(a).utc(),TimeScheduler.Init(),TimeScheduler.updateStart(TimeScheduler.Options.Start)},defaultDate:TimeScheduler.Options.Start.toDate()}).datepicker("show").hide()},TimeShift_Clicked:function(a){var b;a.preventDefault(),b=TimeScheduler.GetSelectedPeriod(),$(this).is(".time-sch-time-button-today")?TimeScheduler.Options.Start=moment().startOf("day"):$(this).is(".time-sch-time-button-prev")?TimeScheduler.Options.Start.tsAdd("minutes",-1*b.TimeframeOverall):$(this).is(".time-sch-time-button-next")&&TimeScheduler.Options.Start.tsAdd("minutes",b.TimeframeOverall),TimeScheduler.Init(),TimeScheduler.updateStart(TimeScheduler.Options.Start)},SelectPeriod:function(a){TimeScheduler.Options.SelectedPeriod=a,TimeScheduler.Scope.selectedPeriod=a,TimeScheduler.Init()},Period_Clicked:function(a){a.preventDefault(),TimeScheduler.SelectPeriod($(this).data("period").Name)}};