var app=angular.module("resourcesApp",["ngRoute","ui.calendar"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"templates/home.html"}),a.when("/login",{templateUrl:"templates/login.html"}),a.when("/resources",{templateUrl:"templates/resources_view.html"}),a.otherwise({redirectTo:"/"}),window.history&&window.history.pushState}]),app.service("getInfoService",["$rootScope","$http",function(a,b){return{getBookings:function(b){a.makeRequest("GET","api/public/booking",null,function(a){b(a)})},getProjects:function(b){a.makeRequest("GET","api/public/project",null,function(a){b(a)})}}}]),app.controller("loginController",["$scope","$http",function(a,b){}]),app.controller("mainController",["$scope","$http","$rootScope",function(a,b,c){c.makeRequest=function(a,c,d,e){d||(d=null),b({url:c,method:a,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0,"Process-Data":!1}}).then(function(a){e(a)},function(a){console.log(a)})}}]),app.controller("resourceViewController",["$scope","$http","$rootScope","getInfoService",function(a,b,c,d){function e(b){angular.forEach(b.data,function(b,c){for(var d={arrayIndex:c,title:b.title,start:b.start_date,end:b.end_date,id:b.id,notes:b.notes,resourceName:b.resource_name,projectName:b.project_name,createdBy:b.created_by},e=0;e<a.projects.length;e++)a.projects[e].name===b.project_name&&(d.color=a.projects[e].colour_code);a.eventSources[0].events.push(d)})}a.creatingBooking=!1,a.eventSources=[{events:[],textColor:"white"}],d.getProjects(function(b){a.projects=b.data,d.getBookings(e)}),a.uiConfig={calendar:{height:"100%",editable:!0,selectable:!0,selectHelper:!0,allDayDefault:!0,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},eventClick:function(b){a.showBookingData=!0,a.bookingToDisplay=a.eventSources[0].events[b.arrayIndex]},eventDrop:function(a,b,d){confirm("The start date for "+a.title+" will be changed to: "+a.start.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?start_date="+a.start.format()+"&end_date="+a.end.format(),null,function(a){console.log(a)}):d()},select:function(b,c,d){a.creatingBooking=!0,a.bookingDates={startDate:b.format(),endDate:c.format()}},eventResize:function(a,b,d){confirm("The end date for "+a.title+" will be changed to: "+a.end.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?end_date="+a.end.format(),null,function(a){console.log(a)}):d()}}},a.closeForm=function(){$("#bookingTitle")[0].value="",$("#bookingNotes")[0].value="",$("#resourceName")[0].value="",$("#projectName")[0].value="",a.creatingBooking=!1,a.showBookingData=!1},a.addBookingToCalendar=function(a,b){$(a).fullCalendar("renderEvent",{title:b.get("title"),start:b.get("start_date"),end:b.get("end_date")},!0)},a.addBookingToDb=function(b){var d=new FormData;d.append("start_date",b.startDate),d.append("end_date",b.endDate),d.append("title",$("#bookingTitle")[0].value),d.append("notes",$("#bookingNotes")[0].value),d.append("resource_name",$("#resourceName")[0].value),d.append("project_name",$("#projectName")[0].value),c.makeRequest("POST","api/public/booking",d,function(b){console.log(b),a.addBookingToCalendar("#resourceCalendar",d)}),a.closeForm()},a.deleteBooking=function(b,d){confirm("Are you sure you want to DELETE "+a.eventSources[0].events[d].title+"?")?c.makeRequest("DELETE","api/public/booking/"+b,null,function(b){console.log(b),a.eventSources[0].events.splice(d,1),a.closeForm()}):a.closeForm()},a.updateBooking=function(b,d){if(confirm("Are you sure you want to UPDATE "+a.eventSources[0].events[d].title+"?")){var e=new FormData;e.append("title",$("#editBookingTitle")[0].value),e.append("notes",$("#editBookingNotes")[0].value),e.append("resource_name",$("#editResourceName")[0].value),e.append("project_name",$("#editProjectName")[0].value),c.makeRequest("POST","api/public/booking/update/"+b,e,function(b){console.log(b),a.closeForm()})}else a.closeForm()}}]);