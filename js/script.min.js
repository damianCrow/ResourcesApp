var app=angular.module("resourcesApp",["ngRoute","ui.calendar"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"templates/home.html"}),a.when("/login",{templateUrl:"templates/login.html"}),a.when("/bookings",{templateUrl:"templates/resources_view.html"}),a.when("/resources",{templateUrl:"templates/resources.html"}),a.when("/projects",{templateUrl:"templates/projects.html"}),a.otherwise({redirectTo:"/"}),window.history&&window.history.pushState}]),app.service("filterService",["$filter","$rootScope",function(a,b){return{filterObjArray:function(b,c,d){d(a("filter")(b,c))}}}]),app.service("getInfoService",["$rootScope","$http",function(a,b){return{getBookings:function(b,c,d){a.makeRequest("GET","api/public/booking",null,function(a){c(b,a.data,d)})},getProjects:function(b){a.makeRequest("GET","api/public/project",null,function(a){b(a)})},getResources:function(b){a.makeRequest("GET","api/public/resource",null,function(a){b(a)})}}}]),app.controller("loginController",["$scope","$http",function(a,b){}]),app.controller("mainController",["$scope","$http","$rootScope",function(a,b,c){c.makeRequest=function(a,c,d,e){d||(d=null),b({url:c,method:a,data:d,transformRequest:angular.identity,headers:{"Content-Type":void 0,"Process-Data":!1}}).then(function(a){e(a)},function(a){console.log(a)})}}]),app.controller("navController",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),app.controller("resourceViewController",["$scope","$http","$rootScope","getInfoService","filterService","$timeout",function(a,b,c,d,e,f){function g(b,c,d){angular.forEach(c,function(c,d){for(var e={arrayIndex:d,title:c.title,start:c.start_date,end:c.end_date,id:c.id,notes:c.notes,resourceName:c.resource_name,projectName:c.project_name,createdBy:c.created_by,textColor:"white"},f=0;f<a.projects.length;f++)a.projects[f].name===c.project_name&&(e.color=a.projects[f].colour_code);b.push(e)}),d&&d(b)}a.creatingBooking=!1,a.filterObj={},a.eventSources=[{events:[]}],d.getProjects(function(b){a.projects=b.data,d.getBookings(a.eventSources[0].events,g),d.getResources(function(b){a.resources=b.data})}),a.uiConfig={calendar:{height:window.innerHeight/1.125,editable:!0,selectable:!0,selectHelper:!0,allDayDefault:!0,header:{left:"month agendaWeek",center:"title",right:"today prev,next"},viewRender:function(a,b){},eventClick:function(b){for(var c=0;c<a.eventSources[0].events.length;c++)parseInt(b.id)===a.eventSources[0].events[c].id&&(a.bookingToDisplay=a.eventSources[0].events[c]);a.showBookingData=!0},eventDrop:function(a,b,d){confirm("The start date for "+a.title+" will be changed to: "+a.start.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?start_date="+a.start.format()+"&end_date="+a.end.format(),null,function(a){console.log(a)}):d()},select:function(b,c,d){a.creatingBooking=!0,a.bookingDates={startDate:b.format(),endDate:c.format()}},eventResize:function(a,b,d){confirm("The end date for "+a.title+" will be changed to: "+a.end.format())?c.makeRequest("PUT","api/public/booking/update/"+a.id+"?end_date="+a.end.format(),null,function(a){console.log(a)}):d()}}},a.closeForm=function(){$("#bookingTitle")[0].value="",$("#bookingNotes")[0].value="",$("#resourceName")[0].value="",$("#projectName")[0].value="",a.creatingBooking=!1,a.showBookingData=!1},a.addBookingToCalendar=function(b,d,e){c.makeRequest("GET","api/public/booking/specific/?"+e,null,function(b){angular.forEach(b.data,function(b){a.eventSources[0].events.push(b)})})},a.addBookingToDb=function(b){var d=new FormData;d.append("start_date",b.startDate),d.append("end_date",b.endDate),d.append("title",$("#bookingTitle")[0].value),d.append("notes",$("#bookingNotes")[0].value),d.append("resource_name",$("#resourceName")[0].value),d.append("project_name",$("#projectName")[0].value),c.makeRequest("POST","api/public/booking",d,function(b){a.addBookingToCalendar("#resourceCalendar",d,"start_date="+d.get("start_date")+"&title="+d.get("title"))}),a.closeForm()},a.deleteBooking=function(b,d){confirm("Are you sure you want to DELETE "+a.eventSources[0].events[d].title+"?")?c.makeRequest("DELETE","api/public/booking/"+b,null,function(b){console.log(b),a.eventSources[0].events.splice(d,1),a.closeForm()}):a.closeForm()},a.updateBooking=function(b,d){if(confirm("Are you sure you want to UPDATE "+a.eventSources[0].events[d].title+"?")){var e=new FormData;e.append("title",$("#editBookingTitle")[0].value),e.append("notes",$("#editBookingNotes")[0].value),e.append("resource_name",$("#editResourceName")[0].value),e.append("project_name",$("#editProjectName")[0].value),c.makeRequest("POST","api/public/booking/update/"+b,e,function(b){console.log(b),a.closeForm()})}else a.closeForm()},a.filterMethod=function(b,c){var f=[];a.filterObj[c]=b,d.getBookings(f,g,function(b){e.filterObjArray(b,a.filterObj,function(b){a.eventSources[0].events.splice(0,a.eventSources[0].events.length),angular.forEach(b,function(b){a.eventSources[0].events.push(b)})})})}}]);